<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Backend Render</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .backend-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .backend-info h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .backend-info .url {
            font-family: monospace;
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            word-break: break-all;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .test-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-box h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s;
            width: 100%;
            margin-bottom: 10px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        button:active {
            transform: translateY(0);
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .loading { color: #ffc107; font-weight: bold; }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online { background: #28a745; }
        .status-offline { background: #dc3545; }
        .status-checking { background: #ffc107; animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .all-tests-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Test Backend Render</h1>
            <p>Safe Download Portal - C·∫ßn Th∆°</p>
        </div>

        <div class="backend-info">
            <h3>
                <span id="status-indicator" class="status-indicator status-checking"></span>
                Backend Status
            </h3>
            <div class="url">https://webfpt-2.onrender.com</div>
            <p style="margin-top: 10px; color: #666;">
                <small>‚ö†Ô∏è L∆∞u √Ω: Free tier c·ªßa Render c√≥ "cold start" ~30 gi√¢y n·∫øu server ƒëang ng·ªß.</small>
            </p>
        </div>

        <div class="test-grid">
            <div class="test-box">
                <h3>1. üìã Admin Info</h3>
                <button onclick="testAdminInfo()">üîç Test Endpoint</button>
                <div class="result" id="result-admin">Nh·∫•n n√∫t ƒë·ªÉ test...</div>
            </div>

            <div class="test-box">
                <h3>2. üìä Reports</h3>
                <button onclick="testReports()">üîç Test Endpoint</button>
                <div class="result" id="result-reports">Nh·∫•n n√∫t ƒë·ªÉ test...</div>
            </div>

            <div class="test-box">
                <h3>3. üìà Stats</h3>
                <button onclick="testStats()">üîç Test Endpoint</button>
                <div class="result" id="result-stats">Nh·∫•n n√∫t ƒë·ªÉ test...</div>
            </div>

            <div class="test-box">
                <h3>4. üíª Windows Software</h3>
                <button onclick="testWindows()">üîç Test Endpoint</button>
                <div class="result" id="result-windows">Nh·∫•n n√∫t ƒë·ªÉ test...</div>
            </div>

            <div class="test-box">
                <h3>5. üìù Office Software</h3>
                <button onclick="testOffice()">üîç Test Endpoint</button>
                <div class="result" id="result-office">Nh·∫•n n√∫t ƒë·ªÉ test...</div>
            </div>

            <div class="test-box">
                <h3>6. üõ†Ô∏è Tools</h3>
                <button onclick="testTools()">üîç Test Endpoint</button>
                <div class="result" id="result-tools">Nh·∫•n n√∫t ƒë·ªÉ test...</div>
            </div>
        </div>

        <div class="test-box">
            <h3>üöÄ Test All Endpoints</h3>
            <button class="all-tests-btn" onclick="testAllEndpoints()">Test T·∫•t C·∫£</button>
            <div class="result" id="result-all">Nh·∫•n n√∫t ƒë·ªÉ test t·∫•t c·∫£ endpoints...</div>
        </div>
    </div>

    <script>
        const BASE_URL = 'https://webfpt-2.onrender.com/api';
        let isBackendOnline = false;

        // Check backend status on load
        checkBackendStatus();

        async function checkBackendStatus() {
            const indicator = document.getElementById('status-indicator');
            indicator.className = 'status-indicator status-checking';
            
            try {
                const res = await fetch(`${BASE_URL}/admin-info/public`, { 
                    method: 'GET',
                    signal: AbortSignal.timeout(10000)
                });
                
                if (res.ok) {
                    indicator.className = 'status-indicator status-online';
                    isBackendOnline = true;
                } else {
                    indicator.className = 'status-indicator status-offline';
                }
            } catch (err) {
                indicator.className = 'status-indicator status-offline';
                console.error('Backend offline:', err);
            }
        }

        async function testEndpoint(url, resultId, label) {
            const result = document.getElementById(resultId);
            result.innerHTML = '<span class="loading">‚è≥ Loading...</span>\nƒêang k·∫øt n·ªëi t·ªõi backend...';
            
            const startTime = Date.now();
            
            try {
                const res = await fetch(url);
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                const data = await res.json();
                
                let output = `<span class="success">‚úÖ Success!</span>\n`;
                output += `Status: ${res.status}\n`;
                output += `Response Time: ${duration}ms\n`;
                output += `\n--- Data ---\n`;
                output += JSON.stringify(data, null, 2);
                
                result.innerHTML = output;
                checkBackendStatus(); // Update status
            } catch (err) {
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                let output = `<span class="error">‚ùå Error!</span>\n`;
                output += `Error: ${err.message}\n`;
                output += `Duration: ${duration}ms\n\n`;
                
                if (err.message.includes('Failed to fetch')) {
                    output += '‚ö†Ô∏è C√≥ th·ªÉ:\n';
                    output += '  ‚Ä¢ Backend ƒëang cold start (ch·ªù 30s)\n';
                    output += '  ‚Ä¢ CORS ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh\n';
                    output += '  ‚Ä¢ Backend offline\n';
                }
                
                result.innerHTML = output;
            }
        }

        function testAdminInfo() {
            testEndpoint(`${BASE_URL}/admin-info/public`, 'result-admin', 'Admin Info');
        }

        function testReports() {
            testEndpoint(`${BASE_URL}/reports/public`, 'result-reports', 'Reports');
        }

        function testStats() {
            testEndpoint(`${BASE_URL}/reports/public/stats`, 'result-stats', 'Stats');
        }

        function testWindows() {
            testEndpoint(`${BASE_URL}/windows`, 'result-windows', 'Windows');
        }

        function testOffice() {
            testEndpoint(`${BASE_URL}/office`, 'result-office', 'Office');
        }

        function testTools() {
            testEndpoint(`${BASE_URL}/tools`, 'result-tools', 'Tools');
        }

        async function testAllEndpoints() {
            const result = document.getElementById('result-all');
            result.innerHTML = '<span class="loading">‚è≥ Testing all endpoints...</span>\n\nƒêang test t·ª´ng endpoint...\n';
            
            const endpoints = [
                { url: '/admin-info/public', name: 'Admin Info' },
                { url: '/reports/public', name: 'Reports' },
                { url: '/reports/public/stats', name: 'Stats' },
                { url: '/windows', name: 'Windows' },
                { url: '/office', name: 'Office' },
                { url: '/tools', name: 'Tools' },
                { url: '/antivirus', name: 'Antivirus' }
            ];

            let output = '';
            let successCount = 0;
            let failCount = 0;

            for (const endpoint of endpoints) {
                try {
                    const startTime = Date.now();
                    const res = await fetch(BASE_URL + endpoint.url);
                    const endTime = Date.now();
                    const duration = endTime - startTime;
                    
                    if (res.ok) {
                        output += `‚úÖ ${endpoint.name}\n`;
                        output += `   URL: ${endpoint.url}\n`;
                        output += `   Status: ${res.status}\n`;
                        output += `   Time: ${duration}ms\n\n`;
                        successCount++;
                    } else {
                        output += `‚ö†Ô∏è ${endpoint.name}\n`;
                        output += `   Status: ${res.status}\n`;
                        output += `   Time: ${duration}ms\n\n`;
                        failCount++;
                    }
                } catch (err) {
                    output += `‚ùå ${endpoint.name}\n`;
                    output += `   Error: ${err.message}\n\n`;
                    failCount++;
                }
            }

            output = `<span class="${successCount > 0 ? 'success' : 'error'}">
K·∫øt qu·∫£: ${successCount}/${endpoints.length} endpoints th√†nh c√¥ng
</span>\n\n${output}`;
            
            result.innerHTML = output;
            checkBackendStatus();
        }
    </script>
</body>
</html>

